<plugin resizable="true">
	<!-- Compute number of audio channels for processing -->
	<ui:set id="channels" value="1" />
	<ui:if test="ex :out_2">
		<ui:set id="channels" value="2" />
	</ui:if>
	<ui:if test="ex :out_4">
		<ui:set id="channels" value="4" />
	</ui:if>
			
	<vbox spacing="4">
		<group ipadding="0" expand="true" fill="true" text="labels.graphs.spectrum">
			<graph width.min="320" height.min="200" expand="true">
				<origin hpos="-1" vpos="-1" visible="false"/>

				<!-- Gray grid -->
				<ui:with ox="0" oy="1">
					<ui:for id="f" first="20" last="90" step="10">
						<marker v="${f}" color="graph_alt_1"/>
						<marker v="${:f*10}" color="graph_alt_1"/>
						<marker v="${:f*100}" color="graph_alt_1"/>
					</ui:for>
					<marker value="20000" color="graph_alt_1"/>
				</ui:with>
				<ui:for id="g" first="-36" last="36" step="24">
					<marker v="${g} db" ox="1" oy="0" color="graph_alt_1"/>
				</ui:for>

				<!-- Yellow grid -->
				<ui:with ox="0" oy="1" color="graph_sec">
					<marker v="100"/>
					<marker v="1000"/>
					<marker v="10000"/>
				</ui:with>
				<ui:with ox="1" oy="0" color="graph_sec">
					<marker v="+24 db"/>
					<marker v="0 db"/>
					<marker v="-24 db"/>
				</ui:with>

				<!-- Meshes -->
				<ui:for id="i" first="1" count="4">
					<ui:set id="hue" value="${(:i-1)/4.0}"/>
					<mesh id="nsg_${i}"
						width="2" smooth="true"
						color="graph_mesh_cycle" color.hue="${hue}"
						fill="true" fcolor="graph_mesh_cycle" fcolor.hue="${hue}" fcolor.a="0.8" />
				</ui:for>

				<!-- Boundaries -->
				<marker ox="2" oy="0" v="1" color="graph_prim" visibility="false"/>
				<!-- +48 dB -->
				<marker ox="0" oy="1" v="24000" color="graph_prim" visibility="false"/>

				<!-- Axis -->
				<axis min="10" max="24000" color="graph_prim" angle="0.0" log="true" visibility="false"/>
				<axis min="-48 db" max="48 db" color="graph_prim" angle="0.5" log="true" visibility="false"/>
				<!-- -48..+48 dB -->
				<axis min="-1" max="1" visible="false" angle="0.5"/>

				<!-- Text -->
				<ui:with ox="0" oy="2" y="0" halign="1" valign="1">
				  <text x="10" text="graph.units.hz"/>
				  <text x="20" text="20"/>
				  <text x="30" text="30"/>
				  <text x="50" text="50"/>
				  <text x="100" text="100"/>
				  <text x="200" text="200"/>
				  <text x="300" text="300"/>
				  <text x="500" text="500"/>
				  <text x="1000" text="graph.values.x_k" text:value="1"/>
				  <text x="2000" text="graph.values.x_k" text:value="2"/>
				  <text x="3000" text="graph.values.x_k" text:value="3"/>
				  <text x="5000" text="graph.values.x_k" text:value="5"/>
				  <text x="10000" text="graph.values.x_k" text:value="10"/>
				  <text x="20000" text="graph.values.x_k" text:value="20"/>
				</ui:with>

				<ui:with x="10" halign="1">
					<text y="36 db" text="+36" valign="-1"/>
					<text y="24 db" text="+24" valign="-1"/>
					<text y="12 db" text="+12" valign="-1"/>
					<text y="0 db" text="0" valign="1"/>
					<text y="-12 db" text="-12" valign="1"/>
					<text y="-24 db" text="-24" valign="1"/>
					<text y="-36 db" text="-36" valign="1"/>
					<text y="1" ox="0" oy="2" text="graph.units.db" valign="-1"/>
				</ui:with>
			</graph>
		</group>
		<group text="labels.noise_generator.generators" ipdadding="0" fill="true">
			<grid rows="7" cols="${1 + 4*4}" transpose="true">
				<void />
				<label text="labels.noise_generator.type" />
				<label text="labels.noise_generator.settings" />
				<label text="labels.noise_generator.amplitude_offset" />
				<void />
				<label text="labels.noise_generator.color" />
				<void />
				
				<ui:for id="i" first="1" count="4">
					<ui:set id="ch" value="_${i}"/>
					<ui:set id="hue" value="${(:i-1)/4.0}"/>
					
					<!-- Separator -->
					<cell rows="7" bg.color="bg" pad.r="2" pad.l="2" expand="false" pad.t="6" pad.b="6">
						<vsep/>
					</cell>
					
					<ui:with expand="true"
						bright="(:nt${ch} igt 0) ? 1 : 0.75"
						bg.bright="(:nt${ch} igt 0) ? 1.0 : :const_bg_darken">

						<cell cols="3"><label text="labels.chan.id" text:id="${i}" pad="6"/></cell>
						<cell cols="2" fill="true"><combo id="nt${ch}" fill="true" pad.l="6" pad.r="6" pad.b="6"/></cell>
						
						<!-- Settings -->
						<cell cols="2">
							<ui:if test="!ex :ns${ch}">
								<button
									id="ni${ch}"
									text="labels.noise_generator.inaudible"
									ui:inject="Button_Cycle"
									size="22"
									font.size="10"
									down.color.hue="${hue}"
									down.hover.color.hue="${hue}"
									text.down.color.hue="${hue}"
									text.down.hover.color.hue="${hue}"
									border.down.color.hue="${hue}"
									border.down.hover.color.hue="${hue}"
									pad.r="6"
									expand="false" />
							</ui:if>
							<ui:if test="ex :ns${ch}">
								<grid bg.color="bg" rows="1" cols="3">
									<button
										id="ns${ch}"
										text="labels.chan.S_olo"
										ui:inject="Button_Cycle"
										size="22"
										font.size="10"
										down.color.hue="${hue}"
										down.hover.color.hue="${hue}"
										text.down.color.hue="${hue}"
										text.down.hover.color.hue=":${hue}"
										border.down.color.hue="${hue}"
										border.down.hover.color.hue="${hue}"
										pad.r="6"
										expand="false" />
									<button
										id="nm${ch}"
										text="labels.chan.M_ute"
										ui:inject="Button_Cycle"
										size="22"
										font.size="10"
										down.color.hue="${hue}"
										down.hover.color.hue="${hue}"
										text.down.color.hue="${hue}"
										text.down.hover.color.hue="${hue}"
										border.down.color.hue="${hue}"
										border.down.hover.color.hue="${hue}"
										pad.r="6"
										expand="false" />
									<button
										id="ni${ch}"
										text="labels.noise_generator.Ina_udible"
										ui:inject="Button_Cycle"
										size="22"
										font.size="10"
										down.color.hue="${hue}"
										down.hover.color.hue="${hue}"
										text.down.color.hue="${hue}"
										text.down.hover.color.hue="${hue}"
										border.down.color.hue="${hue}"
										border.down.hover.color.hue="${hue}"
										pad.r="6"
										expand="false" />
								</grid>
							</ui:if>
						</cell>

						<!-- Amplitude -->						
						<knob id="na${ch}" scolor="(:nt${ch} igt 0) ? 'cycle' : 'cycle_inactive'" scolor.hue="${hue}" size="20" pad.t="6"/>
						<value id="na${ch}" width.min="40" detailed="false" precision="1" pad.t="3"/>
						
						<!-- Color -->
						<cell cols="2">
							<grid rows="2" cols="2">
								<cell cols="2">
									<combo id="cs${ch}" />
								</cell>
								<hbox>
									<knob id="csn${ch}" scolor.hue="${hue}" visibility=":cs${ch} ieq 5"/>
									<knob id="cso${ch}" scolor.hue="${hue}" visibility=":cs${ch} ieq 6"/>
									<knob id="csd${ch}" scolor.hue="${hue}" visibility=":cs${ch} ieq 7"/>
								</hbox>
								<hbox>
									<value id="csn${ch}" same_line="true" visibility=":cs${ch} ieq 5"/>
									<value id="cso${ch}" same_line="true" visibility=":cs${ch} ieq 6"/>
									<value id="csd${ch}" same_line="true" visibility=":cs${ch} ieq 7"/>
								</hbox>
							</grid>
						</cell>
						
						<!-- Custom settings -->
						<cell cols="2">
							<vbox>
								<grid rows="2" cols="1" bg.color="bg_schema" visibility=":nt${ch} ieq 2">
									<label text="labels.noise_generator.distribution" />
									<combo id="ld${ch}" />
								</grid>
								
								<grid rows="9" cols="2" bg.color="bg_schema" visibility=":nt${ch} ieq 3">
									<cell cols="2"><label text="labels.noise_generator.type"/></cell>
									<cell cols="2"><combo id="vt${ch}" /></cell>
									
									<cell cols="2"><label text="labels.noise_generator.window"/></cell>
									<knob id="vw${ch}" scolor.hue="${hue}" />
									<value id="vw${ch}" same_line="true" />
									
									<cell cols="2">
										<label text="labels.noise_generator.arn_delta" visibility=":vt${ch} ieq 2" />
									</cell>
									<knob id="vd${ch}" visibility=":vt${ch} ieq 2" scolor.hue="${hue}" />
									<value id="vd${ch}" visibility=":vt${ch} ieq 2" same_line="true" />
									
									<cell cols="2">
										<button
											id="velcs_1"
											ui:inject="Button_Cycle"
											text="labels.noise_generator.crush"
										/>
									</cell>
									
									<cell cols="2"><label text="labels.noise_generator.crush_prob"/></cell>
									<knob id="vp${ch}" scolor.hue="${hue}" />
									<value id="vp${ch}" same_line="true" />
								</grid>
							</vbox>
						</cell>
	
						<!-- Offset -->
						<knob id="no${ch}" scolor="(:nt${ch} igt 0) ? 'cycle' : 'cycle_inactive'" scolor.hue="${hue}" size="20" pad.t="6"/>
						<value id="no${ch}" width.min="40" detailed="false" pad.t="3" pad.b="6"/>
						
						<!-- Output level meter -->
						<cell rows="6">
							<vbox bg.color="bg">
								<label text="labels.chan.out" />
								<ledmeter angle="1">
									<ledchannel
										id="nlm_${i}"
										min="-72 db"
										max="12 db"
										log="true"
										type="rms_peak"
										peak.visibility="true"
										value.color="mono"
										value.color.hue="${hue}"
									/>
								</ledmeter>
							</vbox>
						</cell>
						
					</ui:with>
				</ui:for>
			</grid>
		</group>
		
		<group text="labels.noise_generator.signal" ipdadding="0" fill="true">
			<grid rows="${:channels*2 + 2}" cols="${9 + (:channels > 1)}">
				<!-- row 1 -->
				<cell rows="2"><void /></cell>
				<cell rows="2"><label text="labels.chan.input" /></cell>
				<cell cols="4">
					<label text="labels.noise_generator.generators" />
				</cell>
				<cell rows="2"><label text="labels.noise_generator.mode" /></cell>
				<ui:if test=":channels > 1">
					<cell rows="2"><label text="labels.noise_generator.settings" /></cell>
				</ui:if>
				<cell rows="2" cols="2"><label text="labels.chan.output" /></cell>
				
				<!-- row 2 -->
				<ui:for id="i" first="1" count="4">
					<label text="labels.chan.id" text:id="${i}" />
				</ui:for>
				
				<ui:for id="i" first="1" count=":channels">
					<ui:set id="hue" value="${(:i-1.0)/:channels}"/>
					
					<!-- row -->
					<label text="labels.chan.id" text:id="${i}" />
					<ledmeter hexpand="true" angle="0">
						<ledchannel id="ilm_${i}"
							min="-72 db" max="+24 db" log="true" type="rms_peak"
							peak.visibility="true"
							value.color="mono_in" value.color.hue="${hue}"
						/>
					</ledmeter>
					
					<ui:for id="j" first="1" count="4">
						<knob id="gg${j}_${i}" scolor.hue="${hue}" />
					</ui:for>
					<combo id="cm_${i}" />
					<ui:if test=":channels > 1">
						<hbox>
							<button
								id="chs_${i}"
								text="labels.chan.S_olo"
								ui:inject="Button_Cycle"
								size="22"
								font.size="10"
								down.color.hue="${hue}"
								down.hover.color.hue="${hue}"
								text.down.color.hue="${hue}"
								text.down.hover.color.hue=":${hue}"
								border.down.color.hue="${hue}"
								border.down.hover.color.hue="${hue}"
								pad.r="6"
								expand="false" />
							<button
								id="chm_${i}"
								text="labels.chan.M_ute"
								ui:inject="Button_Cycle"
								size="22"
								font.size="10"
								down.color.hue="${hue}"
								down.hover.color.hue="${hue}"
								text.down.color.hue="${hue}"
								text.down.hover.color.hue="${hue}"
								border.down.color.hue="${hue}"
								border.down.hover.color.hue="${hue}"
								pad.r="6"
								expand="false" />
						</hbox>
					</ui:if>
					
					<knob id="gout_${i}" scolor.hue="${hue}" />
					
					<ledmeter hexpand="true" angle="0">
						<ledchannel id="olm_${i}"
							min="-72 db" max="+24 db" log="true" type="rms_peak"
							peak.visibility="true"
							value.color="mono_out" value.color.hue="${hue}"
						/>
					</ledmeter>
					
					<!-- row -->
					<cell cols="2"><void /></cell>
					<ui:for id="j" first="1" count="4">
						<value id="gg${j}_${i}" same_line="true" />
					</ui:for>
					<cell cols="${1 + (:channels > 1)}"><void /></cell>
					<value id="gout_${i}" same_line="true" />
					<void />
				</ui:for>
			</grid>
		</group>
	
	</vbox>
</plugin>
